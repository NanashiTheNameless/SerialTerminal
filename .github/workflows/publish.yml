name: Publish
on:
  workflow_dispatch:
  push:
    branches:
      - main

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  Publish:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@8edcb1bdb4e267140fa742c62e395cd74f332709

      - name: Install dependencies
        run: |
          npm install
          npx update-browserslist-db@latest -y

      - name: Set Version
        run: |
          echo ${GITHUB_SHA::8}
          sed -i 's/dev/production '"${GITHUB_SHA::8}"'/' src/version.js
          sed -i 's/localhost/serial.namelessnanashi.dev/' src/version.js

      - name: Build
        run: npm run build
      - name: Setup Pages
        uses: actions/configure-pages@d5606572c479bee637007364c6b4800ac4fc8573
      - name: Upload Pages Artifact
        uses: actions/upload-pages-artifact@2d163be3ddce01512f3eea7ac5b7023b5d643ce1
        with:
          path: ./build
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@854d7aa1b99e4509c4d1b53d69b7ba4eaf39215a
